# ZWToken Subgraph 查询示例
# 可以在 GraphQL Playground 中使用这些查询

# ==================================================
# 基础查询
# ==================================================

# 1. 查询所有 Commitments（按 index 排序）
query GetAllCommitments {
  commitments(first: 100, orderBy: index, orderDirection: asc) {
    id
    commitment
    index
    recipient
    amount
    blockNumber
    blockTimestamp
    transactionHash
  }
}

# 2. 查询特定地址的 Commitments
query GetCommitmentsByRecipient($recipient: Bytes!) {
  commitments(where: { recipient: $recipient }) {
    id
    commitment
    index
    amount
    blockNumber
    blockTimestamp
  }
}

# 变量示例:
# {
#   "recipient": "0x1234567890123456789012345678901234567890"
# }

# 3. 查询 Commitment 总数
# 注意: 总数应该从合约查询 nextIndex() 或 getCommitmentCount()
# const count = await contract.getCommitmentCount();

# 4. 查询特定 index 的 Commitment
query GetCommitmentByIndex($index: BigInt!) {
  commitments(where: { index: $index }) {
    id
    commitment
    index
    recipient
    amount
    blockNumber
    blockTimestamp
    transactionHash
  }
}

# 变量示例:
# {
#   "index": "0"
# }

# ==================================================
# 分页查询
# ==================================================

# 5. 分页查询 Commitments
query GetCommitmentsPaginated($skip: Int!, $first: Int!) {
  commitments(skip: $skip, first: $first, orderBy: index, orderDirection: asc) {
    id
    commitment
    index
    recipient
    amount
  }
}

# 变量示例:
# {
#   "skip": 0,
#   "first": 100
# }

# 6. 分页查询（游标模式）
query GetCommitmentsWithCursor($after: String!) {
  commitments(
    first: 100
    where: { id_gt: $after }
    orderBy: id
    orderDirection: asc
  ) {
    id
    commitment
    index
  }
}

# 变量示例:
# {
#   "after": "0x1234..."
# }

# ==================================================
# 注意: Root 查询
# ==================================================

# Root 信息应该从合约直接查询，不需要通过 subgraph
# const currentRoot = await contract.root();
# const isKnownRoot = await contract.isKnownRoot(rootHash);

# ==================================================
# 高级查询
# ==================================================

# 7. 查询特定区块范围内的 Commitments
query GetCommitmentsByBlockRange($startBlock: BigInt!, $endBlock: BigInt!) {
  commitments(
    where: { blockNumber_gte: $startBlock, blockNumber_lte: $endBlock }
    orderBy: blockNumber
  ) {
    id
    commitment
    index
    recipient
    amount
    blockNumber
    blockTimestamp
  }
}

# 变量示例:
# {
#   "startBlock": "1000000",
#   "endBlock": "1001000"
# }

# 8. 查询特定时间范围内的 Commitments
query GetCommitmentsByTimeRange($startTime: BigInt!, $endTime: BigInt!) {
  commitments(
    where: { blockTimestamp_gte: $startTime, blockTimestamp_lte: $endTime }
    orderBy: blockTimestamp
  ) {
    id
    commitment
    recipient
    amount
    blockTimestamp
  }
}

# 变量示例:
# {
#   "startTime": "1640000000",
#   "endTime": "1650000000"
# }

# 9. 查询特定金额范围的 Commitments
query GetCommitmentsByAmountRange($minAmount: BigInt!, $maxAmount: BigInt!) {
  commitments(
    where: { amount_gte: $minAmount, amount_lte: $maxAmount }
    orderBy: amount
    orderDirection: desc
  ) {
    id
    commitment
    recipient
    amount
    blockNumber
  }
}

# ==================================================
# 聚合查询
# ==================================================

# 10. 查询最近的 Commitments
query GetRecentCommitments {
  commitments(first: 10, orderBy: blockTimestamp, orderDirection: desc) {
    id
    commitment
    index
    recipient
    amount
    blockTimestamp
  }
}

# 11. 多地址查询
query GetCommitmentsForMultipleAddresses($addresses: [Bytes!]!) {
  commitments(where: { recipient_in: $addresses }, orderBy: blockTimestamp) {
    id
    commitment
    recipient
    amount
    blockTimestamp
  }
}

# 变量示例:
# {
#   "addresses": [
#     "0x1234567890123456789012345678901234567890",
#     "0x0987654321098765432109876543210987654321"
#   ]
# }

# ==================================================
# 实用查询
# ==================================================

# 12. 构建 Merkle Tree 所需的最小数据
query GetMerkleTreeData {
  commitments(first: 1000, orderBy: index, orderDirection: asc) {
    commitment
    index
  }
}

# 13. 检查特定地址是否已记录 Commitment
query CheckAddressHasCommitment($recipient: Bytes!) {
  commitments(where: { recipient: $recipient }, first: 1) {
    id
    index
  }
}

# 注意: 也可以直接查合约 hasFirstReceiptRecorded(address) 方法

# 14. 获取最新添加的 Commitments（用于实时更新）
query GetRecentCommitments($sinceTimestamp: BigInt!) {
  commitments(
    where: { blockTimestamp_gt: $sinceTimestamp }
    orderBy: blockTimestamp
    orderDirection: asc
  ) {
    id
    commitment
    index
    recipient
    amount
    blockTimestamp
  }
}

# ==================================================
# 订阅（WebSocket）
# ==================================================

# 15. 订阅新的 Commitments（实时更新）
subscription OnNewCommitment {
  commitments(orderBy: blockTimestamp, orderDirection: desc, first: 1) {
    id
    commitment
    index
    recipient
    amount
    blockTimestamp
  }
}
